# HEIC Image Converter テストケース仕様書

## 1. テスト概要

### 1.1 目的

HEIC Image Converterの機能要件および非機能要件を満たしていることを確認するためのテストケースを定義する。

### 1.2 テスト範囲

- 機能要件（REQ-001 ～ REQ-010）
- 非機能要件（REQ-015, REQ-016, REQ-019, REQ-020）
- バージョン表示オプション（REQ-021）

### 1.3 テスト環境

- OS: macOS, Linux, Windows
- Go: 1.23以上
- テストデータ: HEIC形式の画像ファイル（EXIF情報あり/なし）

### 1.4 テスト実行方法

このプロジェクトには包括的なテストスイートが含まれています。テストを実行するには、以下のコマンドを使用します：

#### 基本的なテスト実行

```bash
# ビルド（テスト実行に必要）
make build-go

# テストを実行
make test
```

または直接実行：

```bash
go test -v ./...
```

#### テストの詳細情報

- **テストファイル**: `main_test.go`に実装されています
- **テストデータ**: `sample/test.HEIC`をテストデータとして使用します
- **テスト実行時**: このファイルが一時ディレクトリに複製されて使用されます

#### テストの内容

テストスイートには以下の内容が含まれています：

- **機能テスト**: HEICからJPEGへの変換、EXIF情報の処理、エラーハンドリングなど
- **統合テスト**: 複数の操作を組み合わせたエンドツーエンドテスト
- **ユニットテスト**: 個別の関数の動作確認

#### CI/CDでのテスト実行

このプロジェクトでは、GitHub Actionsを使用してCI/CDパイプラインが設定されています：

- **Lint**: `.github/workflows/lint.yml` - コードの静的解析
- **Test**: `.github/workflows/test.yml` - テストの自動実行

Pull Requestを作成すると、自動的にlintとtestが実行されます。

## 2. テストケース一覧

### 2.1 REQ-001: HEICからJPEGへの変換

#### TC-001-01: 正常系 - HEICファイルをJPEGに変換

- **前提条件**: 有効なHEICファイルが存在する
- **入力**: `convert test.HEIC`
- **期待結果**:
  - 変換が成功する
  - 出力ファイル `test.jpg` が生成される
  - 出力ファイルが一般的な画像ビューアーで開ける
  - 画像の視覚的な品質が適切に保たれている
  - JPEG品質が95である
- **優先度**: 最高

#### TC-001-02: 正常系 - 大文字拡張子のHEICファイルを変換

- **前提条件**: 拡張子が大文字のHEICファイルが存在する
- **入力**: `convert TEST.HEIC`
- **期待結果**:
  - 変換が成功する
  - 出力ファイル `TEST.jpg` が生成される
- **優先度**: 高

#### TC-001-03: 正常系 - 小文字拡張子のheicファイルを変換

- **前提条件**: 拡張子が小文字のheicファイルが存在する
- **入力**: `convert test.heic`
- **期待結果**:
  - 変換が成功する
  - 出力ファイル `test.jpg` が生成される
- **優先度**: 高

#### TC-001-04: 正常系 - 混合拡張子のHeicファイルを変換

- **前提条件**: 拡張子が混合のHeicファイルが存在する
- **入力**: `convert test.Heic`
- **期待結果**:
  - 変換が成功する
  - 出力ファイル `test.jpg` が生成される
- **優先度**: 中

### 2.2 REQ-002: 単一ファイル変換

#### TC-002-01: 正常系 - 絶対パスで指定したファイルを変換

- **前提条件**: 有効なHEICファイルが存在する
- **入力**: `convert /absolute/path/to/test.HEIC`
- **期待結果**:
  - 変換が成功する
  - 出力ファイルが入力ファイルと同じディレクトリに生成される
- **優先度**: 最高

#### TC-002-02: 正常系 - 相対パスで指定したファイルを変換

- **前提条件**: 有効なHEICファイルが存在する
- **入力**: `convert ./test.HEIC` または `convert ../test.HEIC`
- **期待結果**:
  - 変換が成功する
  - 出力ファイルが入力ファイルと同じディレクトリに生成される
- **優先度**: 最高

#### TC-002-03: 異常系 - 存在しないファイルを指定

- **前提条件**: 指定されたファイルが存在しない
- **入力**: `convert nonexistent.HEIC`
- **期待結果**:
  - エラーメッセージが表示される: "エラー: ファイルまたはディレクトリが見つかりません: nonexistent.HEIC"
  - 終了コードが1である
- **優先度**: 最高

#### TC-002-04: 異常系 - 無効なHEICファイルを指定

- **前提条件**: HEIC形式ではないファイル（例: テキストファイル）が存在する
- **入力**: `convert invalid.txt`
- **期待結果**:
  - エラーメッセージが表示される
  - 変換が失敗する
- **優先度**: 高

#### TC-002-05: 異常系 - 破損したHEICファイルを指定

- **前提条件**: 破損したHEICファイルが存在する
- **入力**: `convert corrupted.HEIC`
- **期待結果**:
  - エラーメッセージが表示される: "✗ 変換失敗: corrupted.HEIC"
  - 変換が失敗する
- **優先度**: 中

### 2.3 REQ-003: ディレクトリ一括変換

#### TC-003-01: 正常系 - ディレクトリ内の全HEICファイルを変換

- **前提条件**: 指定ディレクトリ内に複数のHEICファイルが存在する
- **入力**: `convert /path/to/directory`
- **期待結果**:
  - ディレクトリ内の全HEICファイルが変換される
  - 変換結果のサマリーが表示される: "合計 N 個のファイルを変換しました。"
  - 各ファイルの変換進捗が表示される
- **優先度**: 高

#### TC-003-02: 正常系 - サブディレクトリを含む再帰的変換

- **前提条件**: 指定ディレクトリとサブディレクトリ内にHEICファイルが存在する
- **入力**: `convert /path/to/directory`
- **期待結果**:
  - サブディレクトリ内のHEICファイルも変換される
  - 全ファイルの変換結果のサマリーが表示される
- **優先度**: 高

#### TC-003-03: 正常系 - 空のディレクトリを指定

- **前提条件**: HEICファイルが存在しないディレクトリを指定
- **入力**: `convert /path/to/empty/directory`
- **期待結果**:
  - メッセージが表示される: "HEICファイルが見つかりませんでした。"
  - 正常終了する（終了コード0）
- **優先度**: 中

#### TC-003-04: 異常系 - 存在しないディレクトリを指定

- **前提条件**: 指定されたディレクトリが存在しない
- **入力**: `convert /nonexistent/directory`
- **期待結果**:
  - エラーメッセージが表示される: "エラー: ファイルまたはディレクトリが見つかりません: /nonexistent/directory"
  - 終了コードが1である
- **優先度**: 高

#### TC-003-05: 正常系 - 一部のファイルが変換失敗しても継続

- **前提条件**: ディレクトリ内に有効なHEICファイルと破損したHEICファイルが混在
- **入力**: `convert /path/to/directory`
- **期待結果**:
  - 有効なファイルは変換される
  - 破損したファイルはエラーメッセージを表示してスキップされる
  - 変換成功数のサマリーが表示される
- **優先度**: 高

### 2.4 REQ-004: カレントディレクトリ処理

#### TC-004-01: 正常系 - 引数なしで実行（HEICファイルあり）

- **前提条件**: カレントディレクトリにHEICファイルが存在する
- **入力**: `convert`
- **期待結果**:
  - カレントディレクトリ内の全HEICファイルが変換される
  - 変換結果のサマリーが表示される
- **優先度**: 高

#### TC-004-02: 正常系 - 引数なしで実行（HEICファイルなし）

- **前提条件**: カレントディレクトリにHEICファイルが存在しない
- **入力**: `convert`
- **期待結果**:
  - メッセージが表示される: "HEICファイルが見つかりませんでした。"
  - 正常終了する（終了コード0）
- **優先度**: 中

#### TC-004-03: 正常系 - サブディレクトリも含めて検索

- **前提条件**: カレントディレクトリとサブディレクトリにHEICファイルが存在する
- **入力**: `convert`
- **期待結果**:
  - サブディレクトリ内のHEICファイルも変換される
  - 全ファイルの変換結果のサマリーが表示される
- **優先度**: 高

### 2.5 REQ-005: EXIF情報の保持

#### TC-005-01: 正常系 - EXIF情報ありのHEICファイルを変換（デフォルト）

- **前提条件**: EXIF情報を含むHEICファイルが存在する
- **入力**: `convert test.HEIC`
- **期待結果**:
  - 変換が成功する
  - 出力JPEGファイルにEXIF情報が保持されている
  - 撮影日時、カメラ情報などのメタデータが保持されている
- **優先度**: 高

#### TC-005-02: 正常系 - EXIF情報なしのHEICファイルを変換（デフォルト）

- **前提条件**: EXIF情報を含まないHEICファイルが存在する
- **入力**: `convert test.HEIC`
- **期待結果**:
  - 変換が成功する
  - 出力JPEGファイルが生成される（EXIFなし）
- **優先度**: 高

#### TC-005-03: 正常系 - GPS情報を含むEXIF情報を保持

- **前提条件**: GPS情報を含むEXIF情報を持つHEICファイルが存在する
- **入力**: `convert test.HEIC`
- **期待結果**:
  - 変換が成功する
  - 出力JPEGファイルにGPS情報が保持されている
- **優先度**: 中

### 2.6 REQ-006: EXIF情報の削除オプション

#### TC-006-01: 正常系 - --remove-exifオプションでEXIF情報を削除

- **前提条件**: EXIF情報を含むHEICファイルが存在する
- **入力**: `convert --remove-exif test.HEIC`
- **期待結果**:
  - 変換が成功する
  - 出力JPEGファイルにEXIF情報が含まれていない
  - `--check-exif`で確認するとEXIF情報が削除されていると表示される
- **優先度**: 中

#### TC-006-02: 正常系 - --remove-exifオプションでディレクトリ内の全ファイルを変換

- **前提条件**: EXIF情報を含むHEICファイルが複数存在するディレクトリ
- **入力**: `convert --remove-exif /path/to/directory`
- **期待結果**:
  - 全ファイルが変換される
  - 全出力JPEGファイルにEXIF情報が含まれていない
- **優先度**: 中

#### TC-006-03: 正常系 - --remove-exifオプションでカレントディレクトリを変換

- **前提条件**: カレントディレクトリにEXIF情報を含むHEICファイルが存在する
- **入力**: `convert --remove-exif`
- **期待結果**:
  - 全ファイルが変換される
  - 全出力JPEGファイルにEXIF情報が含まれていない
- **優先度**: 中

### 2.7 REQ-007: EXIF情報の表示オプション

#### TC-007-01: 正常系 - --show-exifオプションでEXIF情報を表示

- **前提条件**: EXIF情報を含むHEICファイルが存在する
- **入力**: `convert --show-exif test.HEIC`
- **期待結果**:
  - EXIF情報が標準出力に表示される
  - 主要なEXIFタグ（撮影日時、カメラ情報、GPS情報など）が表示される
  - 変換も正常に完了する
- **優先度**: 中

#### TC-007-02: 正常系 - --show-exifオプションでEXIF情報なしのファイルを処理

- **前提条件**: EXIF情報を含まないHEICファイルが存在する
- **入力**: `convert --show-exif test.HEIC`
- **期待結果**:
  - "EXIF情報: なし" と表示される
  - 変換も正常に完了する
- **優先度**: 中

#### TC-007-03: 正常系 - --show-exifオプションでディレクトリ内の全ファイルを処理

- **前提条件**: EXIF情報を含むHEICファイルが複数存在するディレクトリ
- **入力**: `convert --show-exif /path/to/directory`
- **期待結果**:
  - 各ファイルのEXIF情報が表示される
  - 全ファイルが変換される
- **優先度**: 中

#### TC-007-04: 正常系 - --show-exifと--remove-exifを同時に指定

- **前提条件**: EXIF情報を含むHEICファイルが存在する
- **入力**: `convert --show-exif --remove-exif test.HEIC`
- **期待結果**:
  - EXIF情報が表示される
  - 変換後のJPEGファイルにはEXIF情報が含まれていない
- **優先度**: 低

### 2.8 REQ-008: EXIF情報のチェック機能

#### TC-008-01: 正常系 - --check-exifオプションで単一JPEGファイルをチェック（EXIFあり）

- **前提条件**: EXIF情報を含むJPEGファイルが存在する
- **入力**: `convert --check-exif test.jpg`
- **期待結果**:
  - "✗ test.jpg: EXIF情報が残っています" と表示される
  - 検出されたEXIFタグが表示される
  - 終了コードが1である
- **優先度**: 中

#### TC-008-02: 正常系 - --check-exifオプションで単一JPEGファイルをチェック（EXIFなし）

- **前提条件**: EXIF情報を含まないJPEGファイルが存在する
- **入力**: `convert --check-exif test.jpg`
- **期待結果**:
  - "✓ test.jpg: EXIF情報は削除されています" と表示される
  - 終了コードが0である
- **優先度**: 中

#### TC-008-03: 正常系 - --check-exifオプションでディレクトリ内の全JPEGファイルをチェック

- **前提条件**: EXIF情報あり/なしのJPEGファイルが混在するディレクトリ
- **入力**: `convert --check-exif /path/to/directory`
- **期待結果**:
  - 各ファイルのチェック結果が表示される
  - サマリーが表示される:
    - 総ファイル数
    - EXIF削除済み数
    - EXIF残存数
  - EXIF残存ファイルがある場合は終了コードが1である
- **優先度**: 中

#### TC-008-04: 正常系 - --check-exifオプションでカレントディレクトリをチェック

- **前提条件**: カレントディレクトリにJPEGファイルが存在する
- **入力**: `convert --check-exif`
- **期待結果**:
  - カレントディレクトリ内の全JPEGファイルがチェックされる
  - サマリーが表示される
- **優先度**: 中

#### TC-008-05: 正常系 - --check-exifオプションで空のディレクトリをチェック

- **前提条件**: JPEGファイルが存在しないディレクトリ
- **入力**: `convert --check-exif /path/to/empty/directory`
- **期待結果**:
  - "JPGファイルが見つかりませんでした。" と表示される
  - 正常終了する（終了コード0）
- **優先度**: 低

#### TC-008-06: 異常系 - --check-exifオプションで存在しないファイルを指定

- **前提条件**: 指定されたファイルが存在しない
- **入力**: `convert --check-exif nonexistent.jpg`
- **期待結果**:
  - 警告メッセージが表示される: "警告: ファイルまたはディレクトリが見つかりません: nonexistent.jpg"
  - 処理が継続される
- **優先度**: 中

### 2.9 REQ-009: エラーハンドリング

#### TC-009-01: 異常系 - ファイルが見つからない場合のエラーメッセージ

- **前提条件**: 指定されたファイルが存在しない
- **入力**: `convert nonexistent.HEIC`
- **期待結果**:
  - エラーメッセージが表示される: "エラー: ファイルまたはディレクトリが見つかりません: nonexistent.HEIC"
  - エラーメッセージは日本語で表示される
  - 終了コードが1である
- **優先度**: 高

#### TC-009-02: 異常系 - HEICファイルのデコード失敗時のエラーメッセージ

- **前提条件**: 破損したHEICファイルが存在する
- **入力**: `convert corrupted.HEIC`
- **期待結果**:
  - エラーメッセージが表示される: "✗ 変換失敗: corrupted.HEIC"
  - エラーの詳細が表示される
  - エラーメッセージは日本語で表示される
- **優先度**: 高

#### TC-009-03: 異常系 - JPEGファイルのエンコード失敗時のエラーメッセージ

- **前提条件**: 書き込み権限のないディレクトリに出力しようとする
- **入力**: `convert test.HEIC`（出力先が書き込み不可）
- **期待結果**:
  - エラーメッセージが表示される: "✗ 変換失敗: test.HEIC"
  - エラーの詳細が表示される
- **優先度**: 中

#### TC-009-04: 正常系 - EXIF情報の処理失敗時の警告メッセージ

- **前提条件**: EXIF情報の処理に失敗しても変換は継続できるHEICファイル
- **入力**: `convert test.HEIC`
- **期待結果**:
  - 警告メッセージが表示される（EXIF処理失敗時）
  - 変換は正常に完了する（EXIFなしでJPEGを生成）
- **優先度**: 中

#### TC-009-05: 正常系 - 複数ファイル処理時に一部エラーが発生しても継続

- **前提条件**: 有効なHEICファイルと破損したHEICファイルが混在するディレクトリ
- **入力**: `convert /path/to/directory`
- **期待結果**:
  - 有効なファイルは変換される
  - 破損したファイルはエラーメッセージを表示してスキップされる
  - 変換成功数のサマリーが表示される
- **優先度**: 高

### 2.10 REQ-010: 色空間変換

#### TC-010-01: 正常系 - RGBA色空間のHEICファイルを変換

- **前提条件**: RGBA色空間のHEICファイルが存在する
- **入力**: `convert test.HEIC`
- **期待結果**:
  - 変換が成功する
  - 出力JPEGファイルが正しく生成される
  - 画像の色が正しく変換される
- **優先度**: 高

#### TC-010-02: 正常系 - NRGBA色空間のHEICファイルを変換

- **前提条件**: NRGBA色空間のHEICファイルが存在する
- **入力**: `convert test.HEIC`
- **期待結果**:
  - 変換が成功する
  - 出力JPEGファイルが正しく生成される
  - 画像の色が正しく変換される
- **優先度**: 高

#### TC-010-03: 正常系 - YCbCr色空間のHEICファイルを変換

- **前提条件**: YCbCr色空間のHEICファイルが存在する
- **入力**: `convert test.HEIC`
- **期待結果**:
  - 変換が成功する
  - 出力JPEGファイルが正しく生成される
  - 画像の色が正しく変換される
- **優先度**: 高

#### TC-010-04: 正常系 - アルファチャンネルがあるHEICファイルを変換

- **前提条件**: アルファチャンネル（透明度）を含むHEICファイルが存在する
- **入力**: `convert test.HEIC`
- **期待結果**:
  - 変換が成功する
  - アルファチャンネルが白背景に合成される
  - 出力JPEGファイルが正しく生成される
- **優先度**: 高

### 2.11 コマンドラインインターフェース（REQ-019）

#### TC-019-01: 正常系 - 不正な引数で実行

- **前提条件**: なし
- **入力**: `convert file1.HEIC file2.HEIC`
- **期待結果**:
  - 使用方法が表示される
  - 終了コードが1である
- **優先度**: 高

#### TC-019-02: 正常系 - 不明なオプションで実行

- **前提条件**: なし
- **入力**: `convert --unknown-option test.HEIC`
- **期待結果**:
  - エラーメッセージが表示される（flagパッケージのデフォルト動作）
- **優先度**: 中

### 2.12 バージョン表示オプション（REQ-021）

#### TC-021-01: 正常系 - -v オプションでバージョン表示

- **前提条件**: なし
- **入力**: `convert -v`
- **期待結果**:
  - バージョン文字列が標準出力に表示される
  - リリースビルド時はタグ形式（例: `v1.0.0`）が表示される
  - ローカルビルド（ldflags 未指定）時は `v0.0.0` が表示される
  - 終了コードが0である
- **優先度**: 高

#### TC-021-02: 正常系 - --version オプションでバージョン表示

- **前提条件**: なし
- **入力**: `convert --version`
- **期待結果**:
  - バージョン文字列が標準出力に表示される
  - `-v` オプションと同様の出力となる
  - 終了コードが0である
- **優先度**: 高

#### TC-021-03: 正常系 - バージョン表示時は他処理を実行しない

- **前提条件**: なし
- **入力**: `convert -v` または `convert --version`
- **期待結果**:
  - バージョン表示のみ行われ、変換処理は実行されない
  - 引数（ファイルパス等）が指定されていても無視される
- **優先度**: 中

#### TC-021-04: 正常系 - バージョン表示は他オプションより優先される

- **前提条件**: なし
- **入力**: `convert -v --show-exif test.HEIC` または `convert --version --remove-exif`
- **期待結果**:
  - バージョン表示のみ行われ、変換・EXIF処理は実行されない
- **優先度**: 低

### 2.13 パフォーマンス要件（REQ-015）

#### TC-015-01: 正常系 - 一般的なサイズのHEICファイルの変換速度

- **前提条件**: 数MB程度のHEICファイルが存在する
- **入力**: `convert test.HEIC`
- **期待結果**:
  - 変換が数秒以内に完了する
  - 実用的な速度を維持している
- **優先度**: 中

#### TC-015-02: 正常系 - 複数ファイルの一括変換速度

- **前提条件**: 10個程度のHEICファイルが存在するディレクトリ
- **入力**: `convert /path/to/directory`
- **期待結果**:
  - 全ファイルの変換が合理的な時間内に完了する
- **優先度**: 低

### 2.14 メモリ使用量（REQ-016）

#### TC-016-01: 正常系 - 大きなHEICファイルの変換時のメモリ使用

- **前提条件**: 大きなHEICファイル（数十MB程度）が存在する
- **入力**: `convert large.HEIC`
- **期待結果**:
  - 変換が正常に完了する
  - メモリリークが発生しない
- **優先度**: 中

## 3. テストデータ要件

### 3.1 必要なテストデータ

#### TD-001: 標準的なHEICファイル

- EXIF情報を含む
- 一般的なサイズ（数MB程度）
- 正常にデコード可能

#### TD-002: EXIF情報なしのHEICファイル

- EXIF情報を含まない
- 正常にデコード可能

#### TD-003: GPS情報を含むHEICファイル

- GPS情報を含むEXIF情報を持つ
- 正常にデコード可能

#### TD-004: アルファチャンネルを含むHEICファイル

- 透明度情報を含む
- 正常にデコード可能

#### TD-005: 異なる色空間のHEICファイル

- RGBA、NRGBA、YCbCrなど異なる色空間
- 正常にデコード可能

#### TD-006: 破損したHEICファイル

- デコード不可能なファイル
- エラーハンドリングのテスト用

#### TD-007: 大きなHEICファイル

- 数十MB程度の大きなファイル
- パフォーマンステスト用

## 4. テスト実行計画

### 4.1 テストフェーズ

#### フェーズ1: 単体テスト

- 各関数の単体テスト
- モックを使用したテスト

#### フェーズ2: 統合テスト

- 実際のHEICファイルを使用したテスト
- エンドツーエンドのテスト

#### フェーズ3: 回帰テスト

- 既存機能が正常に動作することを確認
- 新機能追加後のテスト

### 4.2 テスト実行順序

1. 基本機能テスト（TC-001-01 ～ TC-004-03）
2. EXIF機能テスト（TC-005-01 ～ TC-008-06）
3. エラーハンドリングテスト（TC-009-01 ～ TC-009-05）
4. 色空間変換テスト（TC-010-01 ～ TC-010-04）
5. コマンドラインインターフェース・バージョン表示テスト（TC-019-01 ～ TC-019-02, TC-021-01 ～ TC-021-04）
6. パフォーマンステスト（TC-015-01 ～ TC-016-01）

## 5. テスト結果の記録

### 5.1 テスト結果フォーマット

| テストケースID | テストケース名 | 実行日 | 結果 | 備考 |
|--------------|--------------|--------|------|------|
| TC-001-01 | 正常系 - HEICファイルをJPEGに変換 | YYYY-MM-DD | PASS/FAIL | - |

### 5.2 不具合管理

- 不具合が発見された場合は、バグレポートを作成
- バグレポートには以下を含める:
  - テストケースID
  - 再現手順
  - 期待結果と実際の結果
  - 環境情報

## 6. 受け入れ基準

### 6.1 必須要件の受け入れ基準

- REQ-001 ～ REQ-010のすべてのテストケースがPASSすること
- 優先度「最高」のテストケースが100% PASSすること
- 優先度「高」のテストケースが90%以上PASSすること

### 6.2 非機能要件の受け入れ基準

- パフォーマンス要件（REQ-015）を満たすこと
- メモリリークが発生しないこと（REQ-016）
- エラーメッセージが適切に表示されること（REQ-020）

---

**ドキュメントバージョン**: 1.1  
**作成日**: 2025年12月  
**最終更新日**: 2026年2月
